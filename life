<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äººç”Ÿæ¨¡æ‹Ÿå™¨ - çœŸå®AIç‰ˆ</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .api-config {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #4caf50;
        }
        .situation {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            line-height: 1.6;
        }
        .choices {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 20px 0;
        }
        button {
            padding: 12px;
            border: none;
            border-radius: 6px;
            background: #2196f3;
            color: white;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }
        button:hover {
            background: #1976d2;
        }
        .choice-btn {
            background: #4caf50;
        }
        .choice-btn:hover {
            background: #45a049;
        }
        .custom-btn {
            background: #ff9800;
        }
        .custom-btn:hover {
            background: #f57c00;
        }
        .biography {
            background: #fff3e0;
            padding: 25px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #ff9800;
            line-height: 1.8;
            white-space: pre-wrap;
        }
        .analysis {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 8px;
            margin: 20px 0;
            line-height: 1.7;
            white-space: pre-wrap;
        }
        .loading {
            color: #666;
            font-style: italic;
            text-align: center;
            padding: 20px;
        }
        .hidden {
            display: none;
        }
        .input-section {
            background: #fff3cd;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        textarea, input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-family: inherit;
            font-size: 14px;
            margin-bottom: 10px;
            box-sizing: border-box;
        }
        textarea {
            height: 120px;
            resize: vertical;
        }
        .tab-container {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #eee;
        }
        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }
        .tab.active {
            border-bottom-color: #2196f3;
            color: #2196f3;
            font-weight: bold;
        }
        .choice-item {
            margin: 10px 0;
            padding: 12px;
            background: white;
            border-radius: 6px;
            border-left: 4px solid #2196f3;
        }
        .api-status {
            padding: 8px 12px;
            border-radius: 4px;
            margin: 10px 0;
            font-size: 14px;
        }
        .api-connected {
            background: #e8f5e9;
            color: #2e7d32;
            border: 1px solid #4caf50;
        }
        .api-disconnected {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #f44336;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ­ äººç”Ÿæ¨¡æ‹Ÿå™¨ - çœŸå®AIç‰ˆ</h1>
        
        <div class="api-config">
            <h3>ğŸ”‘ API é…ç½®</h3>
            <input type="password" id="apiKeyInput" placeholder="sk-e9dc34fc06ea413c8c9a4ca8da43d0bc" style="width: 70%;">
            <button onclick="saveAPIKey()">ğŸ’¾ ä¿å­˜API Key</button>
            <div id="apiStatus" class="api-status api-disconnected">âŒ æœªè¿æ¥AIæœåŠ¡</div>
            <small>è·å–API Keyï¼š<a href="https://platform.deepseek.com/" target="_blank">DeepSeekå¹³å°</a></small>
        </div>
        
        <div class="tab-container">
            <div class="tab active" onclick="switchTab('create')">ğŸ‘¤ æˆ‘çš„å›°å¢ƒ</div>
            <div class="tab" onclick="switchTab('choices')">ğŸ›£ï¸ äººç”Ÿé€‰æ‹©</div>
            <div class="tab" onclick="switchTab('result')">ğŸ“– äººç”Ÿæ•…äº‹</div>
        </div>

        <!-- ä¸ªäººä¿¡æ¯æ ‡ç­¾é¡µ -->
        <div id="createTab">
            <div class="input-section">
                <h3>ğŸ‘¤ è¯·è¯¦ç»†æè¿°ä½ çš„æƒ…å†µ</h3>
                <textarea id="userSituation" placeholder="è¯·å°½å¯èƒ½è¯¦ç»†åœ°æè¿°ï¼š
â€¢ ä½ çš„å¹´é¾„ã€èŒä¸šã€ç”Ÿæ´»çŠ¶æ€
â€¢ å…·ä½“é¢ä¸´çš„å›°å¢ƒå’ŒçŸ›ç›¾
â€¢ ä½ çš„æ€§æ ¼ç‰¹ç‚¹ã€ä»·å€¼è§‚
â€¢ ä½ çš„æ‹…å¿§ã€æœŸæœ›å’Œæ¢¦æƒ³
â€¢ ä»»ä½•ç›¸å…³çš„èƒŒæ™¯ä¿¡æ¯

è¶Šè¯¦ç»†ï¼ŒAIç»™å‡ºçš„å»ºè®®è¶Šä¸ªæ€§åŒ–ï¼"></textarea>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 15px 0;">
                    <div>
                        <label>MBTIäººæ ¼ç±»å‹ï¼ˆå¯é€‰ï¼‰</label>
                        <select id="mbtiType">
                            <option value="">è¯·é€‰æ‹©...</option>
                            <option value="INTJ">INTJ - å»ºç­‘å¸ˆ</option>
                            <option value="INTP">INTP - é€»è¾‘å­¦å®¶</option>
                            <option value="ENTJ">ENTJ - æŒ‡æŒ¥å®˜</option>
                            <option value="ENTP">ENTP - è¾©è®ºå®¶</option>
                            <option value="INFJ">INFJ - æå€¡è€…</option>
                            <option value="INFP">INFP - è°ƒåœè€…</option>
                            <option value="ENFJ">ENFJ - ä¸»äººå…¬</option>
                            <option value="ENFP">ENFP - ç«é€‰è€…</option>
                            <option value="ISTJ">ISTJ - ç‰©æµå¸ˆ</option>
                            <option value="ISFJ">ISFJ - å®ˆå«è€…</option>
                            <option value="ESTJ">ESTJ - æ€»ç»ç†</option>
                            <option value="ESFJ">ESFJ - æ‰§æ”¿å®˜</option>
                            <option value="ISTP">ISTP - é‰´èµå®¶</option>
                            <option value="ISFP">ISFP - æ¢é™©å®¶</option>
                            <option value="ESTP">ESTP - ä¼ä¸šå®¶</option>
                            <option value="ESFP">ESFP - è¡¨æ¼”è€…</option>
                        </select>
                    </div>
                    <div>
                        <label>æ˜Ÿåº§ï¼ˆå¯é€‰ï¼‰</label>
                        <select id="zodiacSign">
                            <option value="">è¯·é€‰æ‹©...</option>
                            <option value="ç™½ç¾Šåº§">ç™½ç¾Šåº§ â™ˆ</option>
                            <option value="é‡‘ç‰›åº§">é‡‘ç‰›åº§ â™‰</option>
                            <option value="åŒå­åº§">åŒå­åº§ â™Š</option>
                            <option value="å·¨èŸ¹åº§">å·¨èŸ¹åº§ â™‹</option>
                            <option value="ç‹®å­åº§">ç‹®å­åº§ â™Œ</option>
                            <option value="å¤„å¥³åº§">å¤„å¥³åº§ â™</option>
                            <option value="å¤©ç§¤åº§">å¤©ç§¤åº§ â™</option>
                            <option value="å¤©èåº§">å¤©èåº§ â™</option>
                            <option value="å°„æ‰‹åº§">å°„æ‰‹åº§ â™</option>
                            <option value="æ‘©ç¾¯åº§">æ‘©ç¾¯åº§ â™‘</option>
                            <option value="æ°´ç“¶åº§">æ°´ç“¶åº§ â™’</option>
                            <option value="åŒé±¼åº§">åŒé±¼åº§ â™“</option>
                        </select>
                    </div>
                </div>

                <button onclick="generateChoices()">ğŸ¯ AIåˆ†ææˆ‘çš„å›°å¢ƒå¹¶ç”Ÿæˆé€‰æ‹©</button>
            </div>
        </div>

        <!-- é€‰æ‹©é“è·¯æ ‡ç­¾é¡µ -->
        <div id="choicesTab" class="hidden">
            <div class="situation">
                <h3>ä½ çš„å›°å¢ƒï¼š</h3>
                <div id="displaySituation"></div>
            </div>

            <div id="aiChoicesSection">
                <h3>ğŸ›£ï¸ AIæ¨èçš„äººç”Ÿé“è·¯</h3>
                <div id="aiChoicesList"></div>
            </div>

            <div style="background: #e8f5e9; padding: 15px; border-radius: 8px; margin: 15px 0;">
                <h3>âœï¸ è‡ªå®šä¹‰é€‰æ‹©</h3>
                <p>å¦‚æœAIæ¨èçš„é€‰æ‹©éƒ½ä¸ç¬¦åˆä½ çš„æƒ³æ³•ï¼š</p>
                <input type="text" id="customChoiceInput" placeholder="æè¿°ä½ è‡ªå·±æƒ³æ³•çš„é€‰æ‹©...">
                <button class="custom-btn" onclick="addCustomChoice()">â• æ·»åŠ è‡ªå®šä¹‰é€‰æ‹©</button>
            </div>

            <div id="customChoicesList"></div>

            <button onclick="switchTab('create')">â† è¿”å›ä¿®æ”¹ä¿¡æ¯</button>
        </div>

        <!-- ç»“æœæ ‡ç­¾é¡µ -->
        <div id="resultTab" class="hidden">
            <div class="situation">
                <h3>ä½ é€‰æ‹©çš„é“è·¯ï¼š</h3>
                <div id="selectedChoice"></div>
            </div>

            <div id="resultContent" class="hidden">
                <div class="biography" id="biography"></div>
                <div class="analysis" id="analysis"></div>
            </div>

            <button onclick="switchTab('choices')">â† é‡æ–°é€‰æ‹©é“è·¯</button>
            <button onclick="newSimulation()">ğŸ”„ å…¨æ–°çš„äººç”Ÿæ¨¡æ‹Ÿ</button>
        </div>

        <div id="loading" class="loading hidden">
            <div>AIæ­£åœ¨æ·±åº¦æ€è€ƒä½ çš„äººç”Ÿ...</div>
            <div style="font-size: 14px; margin-top: 10px; color: #888;">
                ğŸ­ åˆ†æä¸ªæ€§ç‰¹è´¨ â†’ ğŸ›£ï¸ æ„æ€å¤šå…ƒè·¯å¾„ â†’ ğŸ“– ç¼–ç»‡äººç”Ÿæ•…äº‹<br>
                â³ æ­£åœ¨è°ƒç”¨çœŸå®AIç”Ÿæˆä¸ªæ€§åŒ–å†…å®¹...
            </div>
        </div>
    </div>

    <script>
        // çŠ¶æ€ç®¡ç†
        let userProfile = {};
        let aiGeneratedChoices = [];
        let customChoices = [];
        let selectedChoice = '';
        let currentAPIKey = '';

        // åˆå§‹åŒ–
        function init() {
            // å°è¯•ä»æœ¬åœ°å­˜å‚¨åŠ è½½API Key
            const savedKey = localStorage.getItem('deepseek_api_key');
            if (savedKey) {
                document.getElementById('apiKeyInput').value = savedKey;
                currentAPIKey = savedKey;
                updateAPIStatus(true);
            }
        }

        // ä¿å­˜API Key
        function saveAPIKey() {
            const apiKey = document.getElementById('apiKeyInput').value.trim();
            if (!apiKey) {
                alert('è¯·è¾“å…¥API Key');
                return;
            }
            currentAPIKey = apiKey;
            localStorage.setItem('deepseek_api_key', apiKey);
            updateAPIStatus(true);
            alert('API Key å·²ä¿å­˜ï¼');
        }

        // æ›´æ–°APIçŠ¶æ€
        function updateAPIStatus(connected) {
            const statusElement = document.getElementById('apiStatus');
            if (connected) {
                statusElement.textContent = 'âœ… å·²è¿æ¥AIæœåŠ¡ï¼ˆä½¿ç”¨çœŸå®AIï¼‰';
                statusElement.className = 'api-status api-connected';
            } else {
                statusElement.textContent = 'âŒ æœªè¿æ¥AIæœåŠ¡';
                statusElement.className = 'api-status api-disconnected';
            }
        }

        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('[id$="Tab"]').forEach(tab => tab.classList.add('hidden'));
            
            const tabIndex = {'create': 1, 'choices': 2, 'result': 3}[tabName];
            document.querySelector(`.tab:nth-child(${tabIndex})`).classList.add('active');
            document.getElementById(tabName + 'Tab').classList.remove('hidden');
        }

        // ç”Ÿæˆé€‰æ‹©
        async function generateChoices() {
            if (!currentAPIKey) {
                alert('è¯·å…ˆé…ç½®API Keyï¼');
                return;
            }

            const situation = document.getElementById('userSituation').value.trim();
            const mbti = document.getElementById('mbtiType').value;
            const zodiac = document.getElementById('zodiacSign').value;
            
            if (!situation) {
                alert('è¯·è¯¦ç»†æè¿°ä½ çš„å›°å¢ƒï¼');
                return;
            }

            userProfile = { situation, mbti, zodiac };
            document.getElementById('displaySituation').textContent = situation;
            
            document.getElementById('loading').classList.remove('hidden');
            switchTab('choices');

            try {
                aiGeneratedChoices = await generateAIChoicesWithAPI(userProfile);
                displayAIChoices(aiGeneratedChoices);
            } catch (error) {
                console.error('ç”Ÿæˆé€‰æ‹©å¤±è´¥:', error);
                alert('ç”Ÿæˆé€‰æ‹©å¤±è´¥ï¼š' + error.message);
            } finally {
                document.getElementById('loading').classList.add('hidden');
            }
        }

        // AIç”Ÿæˆé€‰æ‹© - ä½¿ç”¨çœŸå®API
        async function generateAIChoicesWithAPI(profile) {
            const personalityInfo = [];
            if (profile.mbti) personalityInfo.push(`MBTIç±»å‹ï¼š${profile.mbti}`);
            if (profile.zodiac) personalityInfo.push(`æ˜Ÿåº§ï¼š${profile.zodiac}`);

            const response = await fetch('https://api.deepseek.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${currentAPIKey}`
                },
                body: JSON.stringify({
                    model: 'deepseek-chat',
                    messages: [
                        {
                            role: "system",
                            content: `ä½ æ˜¯ä¸€ä¸ªèµ„æ·±çš„äººç”Ÿå¯¼å¸ˆå’Œåˆ›æ„æ€è€ƒè€…ã€‚è¯·æ ¹æ®ç”¨æˆ·çš„è¯¦ç»†æƒ…å†µï¼Œç”Ÿæˆ3-4ä¸ªå®Œå…¨ä¸åŒã€æœ‰åˆ›æ„ä¸”å®ç”¨çš„äººç”Ÿé€‰æ‹©ã€‚

è¦æ±‚ï¼š
1. æ¯ä¸ªé€‰æ‹©éƒ½è¦å……åˆ†è€ƒè™‘ç”¨æˆ·çš„ä¸ªæ€§ã€ä»·å€¼è§‚å’Œå…·ä½“å¤„å¢ƒ
2. é€‰æ‹©è¦å¤šæ ·åŒ–ï¼šåŒ…å«ä¿å®ˆã€å¹³è¡¡ã€æ¿€è¿›ç­‰ä¸åŒé£æ ¼
3. æ¯ä¸ªé€‰æ‹©éƒ½è¦æœ‰å…·ä½“çš„è¡ŒåŠ¨æ–¹å‘å’Œç‹¬ç‰¹ä»·å€¼
4. é¿å…é™ˆè¯æ»¥è°ƒï¼Œç»™å‡ºçœŸæ­£æœ‰æ´å¯ŸåŠ›çš„å»ºè®®
5. ç”¨è‡ªç„¶çš„ä¸­æ–‡æè¿°ï¼Œä¸è¦ç”¨ç¼–å·

è¯·ç”¨ || åˆ†éš”æ¯ä¸ªé€‰æ‹©ã€‚`
                        },
                        {
                            role: "user",
                            content: `è¿™æ˜¯æˆ‘çš„è¯¦ç»†æƒ…å†µï¼š
${profile.situation}

${personalityInfo.length > 0 ? 'ä¸ªæ€§ä¿¡æ¯ï¼š' + personalityInfo.join('ï¼Œ') : ''}

è¯·åŸºäºæˆ‘çš„å…·ä½“æƒ…å†µï¼Œç»™æˆ‘ä¸€äº›äººç”Ÿé“è·¯çš„å»ºè®®ï¼š`
                        }
                    ],
                    max_tokens: 800,
                    temperature: 0.9, // æ›´é«˜çš„æ¸©åº¦å€¼è®©å›ç­”æ›´å¤šæ ·åŒ–
                    frequency_penalty: 0.5 // é¿å…é‡å¤
                })
            });

            if (!response.ok) {
                const errorText = await response.text();
                throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.status} - ${errorText}`);
            }
            
            const data = await response.json();
            const content = data.choices[0].message.content;
            
            // è§£æé€‰æ‹©
            const choices = content.split('||')
                .filter(choice => choice.trim().length > 10) // è¿‡æ»¤æ‰å¤ªçŸ­çš„é€‰æ‹©
                .map(choice => choice.trim())
                .slice(0, 4); // æœ€å¤š4ä¸ªé€‰æ‹©
            
            if (choices.length < 2) {
                // å¦‚æœè§£æå¤±è´¥ï¼Œå°è¯•å…¶ä»–æ–¹å¼
                const lines = content.split('\n').filter(line => line.trim().length > 20);
                return lines.slice(0, 4);
            }
            
            return choices;
        }

        // æ˜¾ç¤ºAIé€‰æ‹©
        function displayAIChoices(choices) {
            const container = document.getElementById('aiChoicesList');
            container.innerHTML = '';
            
            if (choices.length === 0) {
                container.innerHTML = '<p>æœªèƒ½ç”Ÿæˆé€‰æ‹©ï¼Œè¯·å°è¯•é‡æ–°æè¿°ä½ çš„å›°å¢ƒ</p>';
                return;
            }
            
            choices.forEach((choice, index) => {
                const choiceElement = document.createElement('div');
                choiceElement.className = 'choice-item';
                choiceElement.innerHTML = `
                    <button class="choice-btn" onclick="selectChoice('${choice.replace(/'/g, "\\'")}')">
                        ğŸ›£ï¸ é€‰æ‹© ${index + 1}: ${choice}
                    </button>
                `;
                container.appendChild(choiceElement);
            });
        }

        // æ·»åŠ è‡ªå®šä¹‰é€‰æ‹©
        function addCustomChoice() {
            const customChoice = document.getElementById('customChoiceInput').value.trim();
            if (!customChoice) {
                alert('è¯·è¾“å…¥ä½ çš„é€‰æ‹©ï¼');
                return;
            }

            customChoices.push(customChoice);
            
            const container = document.getElementById('customChoicesList');
            const choiceElement = document.createElement('div');
            choiceElement.className = 'choice-item';
            choiceElement.innerHTML = `
                <button class="custom-btn" onclick="selectChoice('${customChoice.replace(/'/g, "\\'")}')">
                    âœ¨ æˆ‘çš„è‡ªå®šä¹‰é€‰æ‹©: ${customChoice}
                </button>
            `;
            container.appendChild(choiceElement);
            
            document.getElementById('customChoiceInput').value = '';
        }

        // é€‰æ‹©é“è·¯
        async function selectChoice(choice) {
            if (!currentAPIKey) {
                alert('è¯·å…ˆé…ç½®API Keyï¼');
                return;
            }

            selectedChoice = choice;
            document.getElementById('selectedChoice').textContent = choice;
            
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('resultContent').classList.add('hidden');
            switchTab('result');

            try {
                const [biography, analysis] = await generateBiographyAndAnalysisWithAPI(choice);
                displayResults(biography, analysis);
            } catch (error) {
                console.error('ç”Ÿæˆç»“æœå¤±è´¥:', error);
                alert('ç”Ÿæˆäººç”Ÿæ•…äº‹å¤±è´¥ï¼š' + error.message);
            } finally {
                document.getElementById('loading').classList.add('hidden');
            }
        }

        // ç”Ÿæˆä¼ è®°å’Œåˆ†æ - ä½¿ç”¨çœŸå®API
        async function generateBiographyAndAnalysisWithAPI(choice) {
            const personalityInfo = [];
            if (userProfile.mbti) personalityInfo.push(`MBTIï¼š${userProfile.mbti}`);
            if (userProfile.zodiac) personalityInfo.push(`æ˜Ÿåº§ï¼š${userProfile.zodiac}`);

            const response = await fetch('https://api.deepseek.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${currentAPIKey}`
                },
                body: JSON.stringify({
                    model: 'deepseek-chat',
                    messages: [
                        {
                            role: "system",
                            content: `ä½ æ˜¯ä¸€ä¸ªå¯Œæœ‰åŒç†å¿ƒçš„ä¼ è®°ä½œå®¶å’Œäººç”Ÿç­–ç•¥å¸ˆã€‚è¯·æ ¹æ®ç”¨æˆ·çš„è¯¦ç»†æƒ…å†µå’Œé€‰æ‹©ï¼Œåˆ›ä½œä¸€ä¸ªç”ŸåŠ¨çœŸå®çš„äººç”Ÿæ•…äº‹å’Œæ·±åº¦åˆ†æã€‚

è¯·åˆ›ä½œä¸¤ä¸ªéƒ¨åˆ†ï¼š

ã€äººç”Ÿä¼ è®°ã€‘
ç”¨ç¬¬ä¸€äººç§°"æˆ‘"çš„è§†è§’ï¼Œå†™ä¸€ä¸ªçœŸå®æ„Ÿäººçš„çŸ­ç¯‡ä¼ è®°ï¼Œæè¿°é€‰æ‹©è¿™æ¡é“è·¯å5-8å¹´çš„äººç”Ÿå†ç¨‹ã€‚è¦æ±‚ï¼š
- å®Œå…¨åŸºäºç”¨æˆ·çš„æ€§æ ¼ã€èƒŒæ™¯å’Œé€‰æ‹©
- åŒ…å«çœŸå®çš„æƒ…æ„Ÿèµ·ä¼ã€æŒ‘æˆ˜å’Œæˆé•¿
- ä½“ç°ç”¨æˆ·çš„ä¸ªæ€§ç‰¹è´¨
- æœ‰å…·ä½“çš„ç»†èŠ‚å’Œè½¬æŠ˜ç‚¹
- è¯­è¨€ç”ŸåŠ¨ï¼Œåƒåœ¨è®²è¿°çœŸå®äººç”Ÿæ•…äº‹

ã€æ·±åº¦åˆ†æã€‘
ä»å®¢è§‚è§’åº¦åˆ†æè¿™æ¡é“è·¯ï¼Œè¦æ±‚ï¼š
- å…·ä½“ä¼šé‡åˆ°çš„æŒ‘æˆ˜å’Œå›°éš¾ï¼ˆä¸è¦ç”¨æ¦‚ç‡ï¼‰
- å¯èƒ½å‡ºç°çš„æ„å¤–æƒ…å†µå’Œè½¬æœº
- éœ€è¦ç‰¹åˆ«æ³¨æ„çš„äº‹é¡¹å’Œé™·é˜±
- æ½œåœ¨çš„æˆé•¿æœºä¼šå’Œæ”¶è·
- å®ç”¨çš„å»ºè®®å’Œè¡ŒåŠ¨æ­¥éª¤

è¯·ç”¨è‡ªç„¶ã€äººæ€§åŒ–çš„è¯­è¨€ï¼Œå°±åƒæœ‹å‹é—´çš„æ·±åº¦å¯¹è¯ã€‚`
                        },
                        {
                            role: "user",
                            content: `æˆ‘çš„è¯¦ç»†æƒ…å†µï¼š${userProfile.situation}
${personalityInfo.length > 0 ? 'æˆ‘çš„ä¸ªæ€§ï¼š' + personalityInfo.join('ï¼Œ') : ''}
æˆ‘é€‰æ‹©çš„é“è·¯ï¼š${choice}

è¯·ä¸ºæˆ‘åˆ›ä½œäººç”Ÿä¼ è®°å’Œæ·±åº¦åˆ†æï¼š`
                        }
                    ],
                    max_tokens: 2000,
                    temperature: 0.85,
                    frequency_penalty: 0.3
                })
            });

            if (!response.ok) {
                const errorText = await response.text();
                throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.status} - ${errorText}`);
            }
            
            const data = await response.json();
            const content = data.choices[0].message.content;
            
            // æ™ºèƒ½åˆ†å‰²ä¼ è®°å’Œåˆ†æ
            let biography, analysis;
            
            if (content.includes('ã€äººç”Ÿä¼ è®°ã€‘') && content.includes('ã€æ·±åº¦åˆ†æã€‘')) {
                const parts = content.split('ã€æ·±åº¦åˆ†æã€‘');
                biography = parts[0].replace('ã€äººç”Ÿä¼ è®°ã€‘', '').trim();
                analysis = 'ã€æ·±åº¦åˆ†æã€‘' + parts[1];
            } else if (content.includes('äººç”Ÿä¼ è®°') && content.includes('æ·±åº¦åˆ†æ')) {
                const parts = content.split('æ·±åº¦åˆ†æ');
                biography = parts[0].replace('äººç”Ÿä¼ è®°', '').trim();
                analysis = 'æ·±åº¦åˆ†æ' + parts[1];
            } else {
                // å¦‚æœæ‰¾ä¸åˆ°æ˜ç¡®åˆ†éš”ï¼Œå¹³å‡åˆ†å‰²
                const midPoint = Math.floor(content.length / 2);
                biography = content.substring(0, midPoint);
                analysis = content.substring(midPoint);
            }
            
            return [biography, analysis];
        }

        // æ˜¾ç¤ºç»“æœ
        function displayResults(biography, analysis) {
            document.getElementById('biography').textContent = biography;
            document.getElementById('analysis').textContent = analysis;
            document.getElementById('resultContent').classList.remove('hidden');
        }

        // æ–°çš„æ¨¡æ‹Ÿ
        function newSimulation() {
            userProfile = {};
            aiGeneratedChoices = [];
            customChoices = [];
            selectedChoice = '';
            document.getElementById('userSituation').value = '';
            document.getElementById('mbtiType').value = '';
            document.getElementById('zodiacSign').value = '';
            document.getElementById('customChoicesList').innerHTML = '';
            document.getElementById('aiChoicesList').innerHTML = '';
            switchTab('create');
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
